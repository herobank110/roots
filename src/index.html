<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>David Kanekanian</title>
    <script src="https://flackr.github.io/scroll-timeline/dist/scroll-timeline.js"></script>
    <link rel="prefetch" as="image" href="flipbook/flipbook_1001.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1002.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1003.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1004.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1005.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1006.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1007.png" />
    <link rel="prefetch" as="image" href="flipbook/flipbook_1008.png" />

    <link rel="stylesheet" href="style.scss" />
    <script src="velocityScroll.ts"></script>
    <script>
        window.onload = () => {
            const imgs = [...document.querySelectorAll(".frameImg")];
            document.body.style.height = `calc(${imgs.length} * 100lvh)`;
            const size = imgs[0].clientHeight;
            const keyframes = [
                ...imgs.flatMap((_, i) =>
                    i == 0
                        ? Array(6).fill('0px')
                        : [
                            `-${(i - 1) * size}px`,
                            `-${(i - 1) * size}px`,
                            `-${(i - 1) * size}px`,
                            `-${Math.abs((i - 1) * size - 20)}px`,
                            `-${i * size - 10}px`,
                            `-${i * size}px`
                        ]),
            ].reverse();
            document.querySelector('.frameReel').animate(
                { top: keyframes },
                {
                    timeline: new ViewTimeline({ subject: document.body, orientation: 'block' }),
                    // timeRange: 'contain 25% 75%',
                    timeRange: 'contain',
                    fill: 'both'
                }
            )

            function scrollLoop() {
                if (window.scrollY / window.innerHeight > imgs.length - 1) {
                    const SKIP_TO_FRAME = 3;
                    window.scrollTo(0, window.innerHeight * SKIP_TO_FRAME);
                }
                requestAnimationFrame(scrollLoop)
            }

            requestAnimationFrame(scrollLoop)
        }

    </script>
</head>

<body>
    <div class="flipbookRoot">
        <div class="flipbookBorder">
            <div class="frameReel">
                <div class="frameImg" style="background-image:url('frames/210_0070.png')"></div>
                <div class="frameImg" style="background-image:url('frames/210_0060.png')"></div>
                <div class="frameImg" style="background-image:url('frames/210_0050.png')"></div>
                <div class="frameImg" style="background-image:url('frames/210_0040.png')"></div>
                <div class="frameImg" style="background-image:url('frames/210_0030.png')"></div>
                <div class="frameImg" style="background-image:url('frames/210_0020.png')"></div>
                <div class="frameImg" style="background-image:url('frames/210_0010.png')"></div>
                <div class="frameImg" style="background-image:url('frames/114_0020.png')"></div>
                <div class="frameImg" style="background-image:url('frames/114_0010.png')"></div>
                <div class="frameImg" style="background-image:url('frames/112_0030.png')"></div>
                <div class="frameImg" style="background-image:url('frames/112_0020.png')"></div>
                <div class="frameImg" style="background-image:url('frames/112_0010.png')"></div>
                <div class="frameImg" style="background-image:url('frames/010_0030.png')"></div>
                <div class="frameImg" style="background-image:url('frames/010_0020.png')"></div>
                <div class="frameImg" style="background-image:url('frames/010_0010.png')"></div>
            </div>
        </div>
    </div>

</body>

</html>